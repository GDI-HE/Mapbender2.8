OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,pixelTolerance:0,stopSingle:!1},initialize:function(a){this.handlerOptions=OpenLayers.Util.applyDefaults((a||{}).handlerOptions||{},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Click(this,{click:this.onClick},this.handlerOptions)},onClick:function(a){var b=map.getLonLatFromViewPortPx(a.xy),c=$("#queryselect").val(),d=$("#select-lang").val(),
e=new OpenLayers.Geometry.Point(b.lon,b.lat),f=new OpenLayers.Geometry.Point(b.lon,b.lat);vector_marker.removeAllFeatures();vector_marker.addFeatures([new OpenLayers.Feature.Vector(e,{},olSearchSymbol),new OpenLayers.Feature.Vector(f,{},olFeaturequerySymbol)]);"dhm"==c?(setMarkerhint(window.lang.convert("Meldung:"),window.lang.convert("bitte warten...")),a="query/rasterquery.php?coord="+b.lon+", "+b.lat+"&lang="+d,loadFeature(a)):"dhmWms"==c?setMarkerhint(window.lang.convert("Meldung:"),window.lang.convert("bitte warten...")):
("pois"==c?a="query/poiquery.php?qx="+b.lon+"&qy="+b.lat+"&qlayer="+poilayer.params.LAYERS+"&qextent="+map.getExtent().toBBOX()+"&qsize="+map.size.w+" "+map.size.h+"&lang="+d:(setMarkerhint(window.lang.convert("Meldung:"),window.lang.convert("bitte warten...")),a="query/proxy.php?wms=SERVICE=WMS&REQUEST=getFeatureInfo&VERSION=1.1.1&mapfile="+c+"&layers="+c+"&QUERY_LAYERS="+c+"&SRS="+featurequerySrc+"&BBOX="+map.getExtent().toBBOX()+"&WIDTH="+map.size.w+"&HEIGHT="+map.size.h+"&X="+a.xy.x+"&Y="+a.xy.y+
"&INFO_FORMAT=text/html"),loadFeature(a))},showQuerylayer:function(){var a=$("#queryselect").val();"dhm"==a||"dhmWms"==a?setMarkerhint(window.lang.convert("Standardabfrage:"),window.lang.convert("Koordinaten + Hoehe")):setMarkerhint(window.lang.convert("aktuelle Abfrageebene:"),a)},CLASS_NAME:"OpenLayers.Control.Click"});
function showQuerylayer(){var a=$("#queryselect").val();"dhm"==a||"dhmWms"==a?setMarkerhint(window.lang.convert("Standardabfrage:"),window.lang.convert("Koordinaten + Hoehe")):setMarkerhint(window.lang.convert("aktuelle Abfrageebene:"),a)}function loadFeature(a){$.ajax({type:"GET",url:a,success:function(a){a&&(5>a.length&&(a=window.lang.convert("Kein Ergebnis!")),setMarkerhint(window.lang.convert("Abfrageergebnis:"),a))}})}
OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.eTop||(this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top",this.div.appendChild(this.eTop),this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),
this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible");this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(a){var b=parseInt(Math.log(a)/Math.log(10)),b=Math.pow(10,b),a=parseInt(a/b);return(5<a?5:2<a?2:1)*b},update:function(){var a=this.map.getResolution();if(a){var b=this.map.getUnits(),c=OpenLayers.INCHES_PER_UNIT,d=this.maxWidth*
a*c[b],e=1;!0===this.geodesic&&(e=(this.map.getGeodesicPixelSize().w||1.0E-6)*this.maxWidth/(d/c.km),d*=e);var f,g;1E5<d?(f=this.topOutUnits,g=this.bottomOutUnits):(f=this.topInUnits,g=this.bottomInUnits);var h=d/c[f],j=d/c[g],d=this.getBarLen(h),j=this.getBarLen(j),h=d/c[b]*c[f],j=j/c[b]*c[g],b=h/a/e,a=j/a/e;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(a)+"px");"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(b)+"px",this.eTop.innerHTML=d+
" "+f)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});
OpenLayers.Control.LoadingPanel=OpenLayers.Class(OpenLayers.Control,{counter:0,maximized:!1,visible:!0,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a])},setVisible:function(a){(this.visible=a)?OpenLayers.Element.show(this.div):OpenLayers.Element.hide(this.div)},getVisible:function(){return this.visible},hide:function(){this.setVisible(!1)},show:function(){this.setVisible(!0)},toggle:function(){this.setVisible(!this.getVisible())},addLayer:function(a){a.layer&&(a.layer.events.register("loadstart",
this,this.increaseCounter),a.layer.events.register("loadend",this,this.decreaseCounter))},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("preaddlayer",this,this.addLayer);for(var b=0;b<this.map.layers.length;b++){var c=this.map.layers[b];c.events.register("loadstart",this,this.increaseCounter);c.events.register("loadend",this,this.decreaseCounter)}},increaseCounter:function(){this.counter++;0<this.counter&&!this.maximized&&this.visible&&this.maximizeControl()},
decreaseCounter:function(){0<this.counter&&this.counter--;0==this.counter&&this.maximized&&this.visible&&this.minimizeControl()},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);return this.div},minimizeControl:function(a){this.div.style.display="none";this.maximized=!1;null!=a&&OpenLayers.Event.stop(a)},maximizeControl:function(a){this.div.style.display="block";this.maximized=!0;null!=a&&OpenLayers.Event.stop(a)},destroy:function(){if(this.map&&(this.map.events.unregister("preaddlayer",
this,this.addLayer),this.map.layers))for(var a=0;a<this.map.layers.length;a++){var b=this.map.layers[a];b.events.unregister("loadstart",this,this.increaseCounter);b.events.unregister("loadend",this,this.decreaseCounter)}OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.LoadingPanel"});
var map,clickCtrl,measureControls,olSearchSymbol={graphicName:"cross",strokeColor:"#00FFFF",strokeWidth:1,fillOpacity:0,pointRadius:11},olFeaturequerySymbol={graphicName:"circle",strokeColor:"#00FFFF",fillColor:"#00FFFF",strokeWidth:3,fillOpacity:0.2,pointRadius:15,graphicName:"circle"},olGpsSymbol={externalGraphic:"css/images/gpspoint.png",graphicHeight:16,graphicWidth:16},olGpscircleStyle={fillOpacity:0.2,fillColor:"#06C",strokeColor:"#06C",strokeOpacity:0.6},sketchSymbolizers={Point:{pointRadius:6,
graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:2,strokeOpacity:0.8,strokeColor:"#00FFFF"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#FF0000"},Polygon:{strokeWidth:3,strokeOpacity:1,strokeColor:"#FF0000",fillColor:"white",fillOpacity:0.5}},umkreisstyles=new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:5,graphicName:"circle",fillColor:"white",fillOpacity:0.6,strokeWidth:1,strokeOpacity:1,strokeColor:"#CC0000"},
Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#CC0000"},Polygon:{strokeWidth:2,strokeOpacity:1,fillColor:"#CC0000",strokeColor:"#CC0000"}}})]})}),poicontext={getGraphic:function(a){return a.attributes.symbol}},poitemplate={externalGraphic:"config/img/symbol/${getGraphic}",graphicHeight:26,graphicWidth:26,cursor:"pointer"},selectpoiTemplate={externalGraphic:"config/img/symbol/${getGraphic}",graphicHeight:26,graphicWidth:26,cursor:"pointer",fillOpacity:0.7},poiStyle=new OpenLayers.Style(poitemplate,
{context:poicontext}),poiStyleselect=new OpenLayers.Style(selectpoiTemplate,{context:poicontext}),styleMapPoi=new OpenLayers.StyleMap({"default":poiStyle,select:poiStyleselect}),style=new OpenLayers.Style;style.addRules([new OpenLayers.Rule({symbolizer:sketchSymbolizers})]);var styleMap=new OpenLayers.StyleMap({"default":style});
function Service(a,b,c,d,e,f,g,h){a=$("<li>",{serviceid:a,"class":"service",title:b,desc:c,getMapURL:d,status:e,logoUrl:f,symbolLink:g,avail:h});d=$('<div class="service_container"></div>');d.append($('<table style="margin: 0px; padding: 0px; float:left;"><tr style="margin: 0px; padding: 0px;"><td style="margin: 0px; padding: 0px; height:43px; width:55px; text-align: center; vertical-align: middle;"><img style="max-height: 43px; max-width: 55px;  max-height: 43px;" src="'+f+'" class="service_logo" alt="Logo"/></td></tr></table>'));
d.append($("<div>",{"class":"icon layer_remove",text:" "}).click(function(){removeService($(this).parent().parent())}));d.append($("<div>",{"class":"icon layer_add",text:" "}).click(function(){addService($(this).parent().parent())}));d.append('<div class="collapsible unselected" data-role="collapsible" data-collapsed="true" data-theme="a" data-content-theme="c" data-inset="true"><h3>'+b+"</h3><h3>"+b+"</h3><p>"+c+"</p></div>");a.append(d);return a}
function BaseLayer(a,b){return $("<div>",{text:a,title:a,layerids:b,"class":"baselayer base_unchecked"}).click(function(){switchVisibility($(this))})}
function ResultLayer(a,b,c,d,e,f,g,h){a=$("<div>",{layerid:a,name:c,"class":"layer",title:b,desc:d,previewUrl:e,queryable:f,getMapURL:g,bbox:h});a.append($("<div>",{"class":"icon query_preview "+(f?"query_info":"query_noinfo"),text:" "}));a.append($("<div>",{"class":"layer_icon icon layer_add",text:" "}).click(function(){switchLayer($(this).parent())}));a.append('<div class="collapsible unselected" data-role="collapsible" data-collapsed="true" data-theme="a" data-content-theme="c" data-inset="true"><h3>'+
b+"</h3><h3>"+b+"</h3><p>"+d+"</p></div>");return a}
function OwnLayer(a,b,c,d,e,f,g,h,j,k,l){var m=$("<div>",{layerid:a,name:c,servicetitle:e,servicedesc:f,"class":"layer",title:b,desc:d,previewUrl:g,queryable:h,getMapURL:j,bbox:k,avail:l});m.append($("<div>",{"class":"layer_icon icon layer_remove",text:" "}).click(function(){removeLayer($(this).parent())}));h?m.append($("<div>",{"class":"icon query_queryable query_unchecked",text:" "}).click(function(){query_check($(this))})):m.append($("<div>",{"class":"icon query_queryable query_noinfo",text:" "}));
m.append($("<div>",{"class":"icon layer_visibility layer_checked",text:" "}).click(function(){switchVisibility($(this).parent())}));m.append($("<div>",{"class":"icon move arrow_up",text:" "}).click(function(){up(a)}));h=$('<div class="collapsible unselected" data-role="collapsible" data-collapsed="true" data-theme="a" data-content-theme="c" data-inset="true"></div>');h.append("<h3>"+b+"</h3>");var p=$("<table></table>"),n=$("<tr></tr>"),o=$('<td class="layerinfo"></td>');g&&o.append($("<div>",{"class":"icon layer_preview",
text:" "}).click(function(){zoomToBbox(k);$.mobile.changePage($("#mappage"),pageTransition)}));o.append("</br><p>"+l+"%</p>");g=$("<td></td>");g.append("<p><b>"+e+"</b></p><p>"+f+"</p>");g.append("<p><b>"+b+"</b></p><p>"+d+"</p>");n.append(o);n.append(g);p.append(n);h.append(p);b=j+"service=wms&version=1.1.1&request=GetLegendGraphic&format=image/png&layer="+c;h.append($("<br><p><b>Legende:</b></p>"));h.append($('<div class="legendcontainer" data-role="content"><img src="'+b+'"></div>'));m.append(h);
return m}
function FeatureResult(a,b,c,d){this.layername=a;this.position=b;this.url=c;this.html=$("<div>",{"data-sort":b});b=$('<div class="collapsible unselected" data-role="collapsible" data-collapsed="true" data-theme="a" data-content-theme="c" data-inline="true" data-inset="true"></div>');b.append("<h3>"+a+"</h3>");b.append($('<div class="legendcontainer" data-role="content"><img src="'+d+'"></div>'));a=$('<a data-role="button" data-icon="arrow-r" data-iconpos="right" target="_blank" href="'+c+'">Info</a>');
c=$('<div class="ui-grid-a">');d=$('<div class="ui-block-a">');d.append(b);b=$('<div class="ui-block-b">');b.append(a);c.append(d);c.append(b);this.html.append(c)}var maxlayers=5,maxresults=40,baseinfo=[];searchUrl="mod_mapbender/search_proxy.php?languageCode=de&resultTarget=web&maxResults="+maxresults;
function addmyLayer(){OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,pixelTolerance:0,stopSingle:!1},initialize:function(a){this.handlerOptions=OpenLayers.Util.applyDefaults((a||{}).handlerOptions||{},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Click(this,{click:this.onClick},this.handlerOptions)},onClick:function(a){var b=map.getLonLatFromViewPortPx(a.xy),c=$("#ownlist").find(".query_checked").parent(),
d=$("#select-lang").val(),e=new OpenLayers.Geometry.Point(b.lon,b.lat),f=new OpenLayers.Geometry.Point(b.lon,b.lat);vector_marker.removeAllFeatures();vector_marker.addFeatures([new OpenLayers.Feature.Vector(e,{},olSearchSymbol),new OpenLayers.Feature.Vector(f,{},olFeaturequerySymbol)]);e="p"===$("#select-feature-info").val()?!0:!1;!0==e?setMarkerhint(window.lang.convert("Meldung:"),window.lang.convert("bitte warten...")):0==c.length&&withHeight||1==c.length&&!1==withHeight?setMarkerhint(window.lang.convert("Meldung:"),
window.lang.convert("bitte warten...")):$.mobile.changePage($("#featureinforesult"),pageTransition);$("#featurelist").empty();getHeight(b.lon,b.lat,d);if(0<c.length&&withHeight)for(b=0;b<c.length;b++){if(d=c,1<c.length&&(d=$(c[b])),0<d.find(".layer_checked").length){var f=d.attr("getmapurl")+"&SERVICE=WMS&REQUEST=getFeatureInfo&VERSION=1.1.1&mapfile="+d.attr("name")+"&layers="+d.attr("name")+"&QUERY_LAYERS="+d.attr("name")+"&SRS="+featurequerySrc+"&BBOX="+map.getExtent().toBBOX()+"&WIDTH="+map.size.w+
"&HEIGHT="+map.size.h+"&X="+a.xy.x+"&Y="+a.xy.y+"&INFO_FORMAT=text/html&FORMAT=image/png&STYLES=&FEATURE_COUNT=100",g=d.attr("getmapurl")+"service=wms&version=1.1.1&request=GetLegendGraphic&format=image/png&layer="+d.attr("name");featureValid(new FeatureResult(d.attr("title"),layerInList($("#ownlist"),d.attr("layerid")),f,g));e?(d=$('<iframe src="'+f+'" class="query_iframe"><p>Die Abfrage kann leider nicht angezeigt werden.</p></img>'),setMarkerhint("Abfrageergebnis:",d)):(d=$('<iframe src="'+f+'" class="query_iframe_full"><p>Die Abfrage kann leider nicht angezeigt werden.</p></img>'),
$("#ficontentdiv").text(""),$("#ficontentdiv").append(d))}}else if(1==c.length&&!1==withHeight)for(b=0;b<c.length;b++)d=c,1<c.length&&(d=$(c[b])),0<d.find(".layer_checked").length&&(f=d.attr("getmapurl")+"&SERVICE=WMS&REQUEST=getFeatureInfo&VERSION=1.1.1&mapfile="+d.attr("name")+"&layers="+d.attr("name")+"&QUERY_LAYERS="+d.attr("name")+"&SRS="+featurequerySrc+"&BBOX="+map.getExtent().toBBOX()+"&WIDTH="+map.size.w+"&HEIGHT="+map.size.h+"&X="+a.xy.x+"&Y="+a.xy.y+"&INFO_FORMAT=text/html&FORMAT=image/png&STYLES=&FEATURE_COUNT=100",
g=d.attr("getmapurl")+"service=wms&version=1.1.1&request=GetLegendGraphic&format=image/png&layer="+d.attr("name"),featureValid(new FeatureResult(d.attr("title"),layerInList($("#ownlist"),d.attr("layerid")),f,g)),d=$('<iframe src="'+f+'" class="query_iframe"><p>Die Abfrage kann leider nicht angezeigt werden.</p></img>'),setMarkerhint("Abfrageergebnis:",d));else f="query/rasterqueryWms.php?coord="+b.lon+", "+b.lat+"&lang="+d,loadFeature(f)},CLASS_NAME:"OpenLayers.Control.Click"});$("#mapbenderbut").click(function(){$.mobile.changePage($("#mod_mapbender"),
pageTransition);refresh()});$("#mapbendersearchformbut").click(function(){searchMaps(searchUrl+"&searchText="+$("#mapbendersearchfield").val())});$(document).on("keypress","#mapbendersearchfield",function(a){13===a.keyCode&&searchMaps(searchUrl+"&searchText="+$("#mapbendersearchfield").val())});$(document).on("expand","div[data-role=collapsible]",function(){$("div[data-role=collapsible]").not($(this)).trigger("collapse")});$(".addToMapBut").click(function(){$("div[data-role=collapsible]").not(".ui-collapsible-collapsed").trigger("collapse");
$.mobile.changePage($("#mappage"),pageTransition)});addBaselayers()}function addFeatureCallback(a){$("#featurelist").append(a.html);refreshFeatureResults()}
function getHeight(a,b,c){$.ajax({type:"GET",url:"query/rasterqueryWms.php?coord="+a+", "+b+"&lang="+c,success:function(a){if(a){5>a.length&&(a=window.lang.convert("Kein Ergebnis!"));var b=$("<div>"),c=$('<div class="collapsible unselected" data-role="collapsible" data-collapsed="true" data-theme="a" data-content-theme="c" data-inline="true" data-inset="true"></div>');c.append("<h3>DHM</h3>");c.append(a);b.append(c);$("#featurelist").prepend(b);refreshFeatureResults()}}})}
function featureValid(a){$.ajax({url:"map.php",type:"POST",data:{feature_url:a.url},success:function(b){b=b.split("\n")[0];"true"==b&&($("#markerhint").css("visibility","visible"),addFeatureCallback(a));"false"==b&&$("#markerhint").css("visibility","hidden");"Mb2OWSPROXY"==b&&$("#markerhint").css("visibility","hidden")}})}
function preview(a,b,c){$.ajax({previewurl:a,layerid:b,bbox:c,success:function(){$("#preview").find("div[data-role=content]").empty();$("#preview").find("div[data-role=content]").append('<img src="'+$(this).attr("previewurl")+'" alt="image" style="width:200px;">');var a=$(this).attr("bbox"),b=$(this).attr("layerid");$("#preview_zoom").click(function(){getOpenlayersIndex(b);zoomToBbox(a);$.mobile.changePage($("#mappage"),pageTransition)});$("#preview").popup("open")}})}
getInfo=function(a){$("#info_content").empty();$("#info_content").append(a);$("#info").popup("open")};function getOpenlayersIndex(a){for(var b=0;b<map.layers.length;b++)if(map.layers[b].name==a)return b;return-1}function addOpenlayer(a,b,c){a=new OpenLayers.Layer.WMS(a,c,{layers:b,format:"image/png",transparent:"TRUE",transitionEffect:"resize"},{projection:mapProj,units:projUnits,opacity:0.8,singleTile:!0,isBaseLayer:!1,visibility:!0,alwaysInRange:!0});map.addLayer(a);map.setLayerIndex(a,0)}
function removeOpenlayer(a){a=getOpenlayersIndex(a);0<=a&&map.removeLayer(map.layers[a])}function setOpenBaselayer(a){a=getOpenlayersIndex(a);0<=a&&map.setBaseLayer(map.layers[a])}function selectOpenlayer(a,b){var c=getOpenlayersIndex(a);0<=c&&map.layers[c].setVisibility(b)}
function addOpenBaselayer(a,b){$.getJSON("mod_mapbender/search_proxy.php?languageCode=de&resultTarget=web&resourceIds="+b,function(b){$.each(b.wms.srv,function(b,c){$.each(c.layer,function(b,d){d.layer&&(d=d.layer[0]);var h=new OpenLayers.Layer.WMS(a,c.getMapUrl,{layers:d.name,format:"image/png",transparent:"false",transitionEffect:"resize"},{projection:mapProj,units:projUnits,singleTile:!0,isBaseLayer:!0,alwaysInRange:!0});map.addLayers([h])})})})}
function zoomToBbox(a){var b=a.split(","),a=(new OpenLayers.LonLat(b[0],b[1])).transform(wgs84Proj,mapProj),b=(new OpenLayers.LonLat(b[2],b[3])).transform(wgs84Proj,mapProj);map.zoomToExtent(new OpenLayers.Bounds(a.lon,a.lat,b.lon,b.lat))}function numServices(){return $("#resultlist").find(".service").length}function numResultLayers(a){return a.find(".layer").length}function layerInList(a,b){for(var c=a.find(".layer"),d=0;d<c.length;d++)if($(c[d]).attr("layerid")==b)return d;return-1}
function up(a){var b=layerInList($("#ownlist"),a);0<b&&($($("#ownlist").find(".layer")[b]).after($($("#ownlist").find(".layer")[b-1])),console.log("todo: layerreihenfolge"),map.raiseLayer(map.layers[getOpenlayersIndex(a)],1),validateArrows(),refresh())}function numOwnlayers(){return $("#ownlist").find(".layer").length}
function refresh(){$("#resultlist").listview("refresh");$($("#ownlist").parent()).listview("refresh");$("div[data-role=collapsible]").collapsible();$("a[data-role=button]").button()}function refreshFeatureResults(){$($("#featurelist").parent()).listview("refresh");$("div[data-role=collapsible]").collapsible();$("a[data-role=button]").button();$("#featurelist").append(getSorted($("#featurelist").children(),"data-sort"))}
function getSorted(a,b){return $($(a).toArray().sort(function(a,d){var e=parseInt(a.getAttribute(b)),f=parseInt(d.getAttribute(b));return e-f}))}
function validateLayers(){layers=$("#resultlist").find(".layer");$.each(layers,function(a,b){0<=layerInList($("#ownlist"),$(b).attr("layerid"))?($(b).find(".layer_icon").first().attr("class","layer_icon icon layer_remove"),$(b).find(".collapsible").first().removeClass("unselected").addClass("selected")):($(b).find(".layer_icon").first().attr("class","layer_icon icon layer_add"),$(b).find(".collapsible").first().removeClass("selected").addClass("unselected"))})}
function validateArrows(){var a=$("#ownlist").find(".move");$(a[0]).attr("class","icon move arrow_empty");1<a.length&&$(a[1]).attr("class","icon move arrow_up")}function query_check(a){$(a).hasClass("query_unchecked")?$(a).addClass("query_checked").removeClass("query_unchecked"):$(a).addClass("query_unchecked").removeClass("query_checked")}
function addLayer(a){if(numOwnlayers()>=maxlayers)getInfo("Es k&ouml;nnen nicht mehr als "+maxlayers+" Ebenen zur Auswahl hinzugef&uuml;gt werden.");else{$.mobile.showPageLoadingMsg();if(0>layerInList($("#ownlist"),$(a).attr("layerid")))return $("#ownlist").append(OwnLayer(a.attr("layerid"),a.attr("title"),a.attr("name"),a.attr("desc"),a.parent().attr("title"),a.parent().attr("desc"),a.attr("previewUrl"),"true"==a.attr("queryable"),a.attr("getMapUrl"),a.attr("bbox"),a.parent().attr("avail"))),validateLayers(),
validateArrows(),refresh(),addOpenlayer(a.attr("layerid"),a.attr("name"),a.attr("getMapUrl")),$.mobile.hidePageLoadingMsg(),!0;$.mobile.hidePageLoadingMsg()}return!1}function removeLayer(a){layerInList($("#ownlist"),$(a).attr("layerid"));$($("#ownlist").find(".layer")[layerInList($("#ownlist"),$(a).attr("layerid"))]).remove();validateLayers();validateArrows();refresh();removeOpenlayer($(a).attr("layerid"))}
function switchLayer(a){0>layerInList($("#ownlist"),$(a).attr("layerid"))?addLayer(a):removeLayer(a)}function addService(a){for(var a=a.find(".layer"),b=0;b<a.length&&!(addLayer($(a[b])),numOwnlayers()>maxlayers);b++);}function removeService(a){$.each(a.find(".layer"),function(a,c){removeLayer($(c))})}
function switchVisibility(a){$(a).hasClass("layer")?($(a).find(".layer_visibility").toggleClass("layer_checked").toggleClass("layer_unchecked"),selectOpenlayer($(a).attr("layerid"),$(a).find(".layer_visibility").hasClass("layer_checked"))):($("#baselayers").find(".base_checked").addClass("base_unchecked").removeClass("base_checked"),$(a).addClass("base_checked").removeClass("base_unchecked"),setOpenBaselayer($(a).attr("layerids")))}
function setQueryable(a,b){b?$(a).find(".query_queryable").addClass("query_checked").removeClass("query_noinfo"):$(a).find(".query_queryable").addClass("query_noinfo").removeClass("query_checked").removeClass("query_unchecked")}function setQueryCheck(a,b){b?$(a).find(".query_queryable").addClass("query_checked").removeClass("query_unchecked"):$(a).find(".query_queryable").addClass("query_unchecked").removeClass("query_checked")}
function base_check(a){$("#baselayers").find(".base_checked").addClass("base_unchecked").removeClass("base_checked");$(a).addClass("base_checked").removeClass("base_unchecked")}
function searchMaps(a){$.mobile.showPageLoadingMsg();$("#search_results").empty();$.getJSON(a,function(a){a=parseMapBenderJson(a);appendData(a.services,a.layers,a.nresults);$.mobile.hidePageLoadingMsg();a.nresults>maxresults&&getInfo("Es gab "+a.nresults+" Treffer, es k\u00f6nnen aber nur "+maxresults+" Ergebnisse angezeigt werden.</br><b>Schr\u00e4nken Sie Ihre Suche weiter ein.</b>")})}
function searchWmc(a){$.mobile.showPageLoadingMsg();$("#search_results").empty();$.getJSON(a,function(a){appendWmc(a);$.mobile.hidePageLoadingMsg()})}function searchLayer(a){$.mobile.showPageLoadingMsg();$("#search_results").empty();appendLayer(a);$.mobile.hidePageLoadingMsg()}
function parseMapBenderJson(a){var b=[],c=[];$.each(a.wms.srv,function(a,e){for(var f=!1,g=0;g<b.length;g++)if(b[g].id==e.id){f=!0;break}!e.logged&&!e.nwaccess&&(f||b.push(e),$.each(e.layer,function(a,b){b.layer?$.each(b.layer,function(a,b){""!=b.name&&c.push([e.id,b])}):""!=b.name&&c.push([e.id,b])}))});return{services:b,layers:c,nresults:a.wms.md.nresults}}
function appendData(a,b,c){$("#resultlist").empty();for(var d=0;d<a.length;d++){var e=a[d];service=Service(e.id,e.title,$(e).attr("abstract"),e.getMapUrl,e.status,""==e.logoUrl?"mod_mapbender/img/defaulicon.png":e.logoUrl,e.symbolLink,e.avail);for(var f=0;f<b.length;f++){var g=b[f],h=g[1];g[0]==e.id&&service.append(ResultLayer(h.id,h.title,h.name,$(h).attr("abstract"),h.previewURL,"1"==h.queryable,e.getMapUrl,h.bbox))}$("#resultlist").append(service)}$("#resultlist").prepend('<li data-theme="b">Suchergebnis: '+
numServices()+" Dienste, "+numResultLayers($("#resultlist"))+" Layer ("+c+" Treffer) </li>");validateLayers();refresh()}
function appendWmcData(a,b,c,d,e){$("#ownlist").empty();for(var f=[],g=0;g<a.length;g++)for(var h=a[g],j=0;j<b.length;j++){var k=b[j],l=k[1];k[0]==h.id&&f.push(OwnLayer(l.id,l.title,l.name,$(l).attr("abstract"),h.title,$(h).attr("abstract"),l.previewURL,"1"==l.queryable,h.getMapUrl,l.bbox,h.avail))}for(g=0;g<c.length;g++)for(j=0;j<f.length;j++)if(c[g].layerId==f[j].attr("layerid")){k=f[j];$("#ownlist").append(k);addOpenlayer(k.attr("layerid"),k.attr("name"),k.attr("getMapUrl"));c[g].active||switchVisibility(k);
c[g].layerQueryable?(setQueryable(k,!0),setQueryCheck(k,c[g].queryLayer)):setQueryable(k,!1);break}validateLayers();validateArrows();b=d.split(",");a=(new OpenLayers.LonLat(b[0],b[1])).transform(e,mapProj);e=(new OpenLayers.LonLat(b[2],b[3])).transform(e,mapProj);map.zoomToExtent(new OpenLayers.Bounds(a.lon,a.lat,e.lon,e.lat))}
function appendLayerData(a,b){$("#ownlist").empty();for(var c=[],d=0;d<a.length;d++)for(var e=a[d],f=0;f<b.length;f++){var g=b[f],h=g[1];g[0]==e.id&&c.push(OwnLayer(h.id,h.title,h.name,$(h).attr("abstract"),e.title,$(e).attr("abstract"),h.previewURL,"1"==h.queryable,e.getMapUrl,h.bbox,e.avail))}g=c[0];$("#ownlist").append(g);addOpenlayer(g.attr("layerid"),g.attr("name"),g.attr("getMapUrl"));"true"==g.attr("queryable")?(setQueryable(g,!0),setQueryCheck(g,!0)):setQueryable(g,!1);validateLayers();validateArrows();
d=g.attr("bbox").split(",");c=(new OpenLayers.LonLat(d[0],d[1])).transform("EPSG:4326",mapProj);d=(new OpenLayers.LonLat(d[2],d[3])).transform("EPSG:4326",mapProj);map.zoomToExtent(new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat))}function clearOwnlist(){for(var a=$("#ownlist").find(".layer"),b=0;b<a.length;b++)removeLayer(a[b])}
function appendWmc(a){for(var b=0;b<a.backGroundLayer.length;b++){var c=a.backGroundLayer[b];if(c.active)for(var d=$("#baselayers").find(".baselayer"),e=0;e<d.length;e++)if($(d[e]).attr("layerids")==c.name){switchVisibility(d[e]);break}}clearOwnlist();var f="";$.each(a.layerList,function(a,b){f=f+","+b.layerId});f=f.substr(1,f.length);$.getJSON(searchUrl+"&resourceIds="+f,function(b){b=parseMapBenderJson(b);appendWmcData(b.services,b.layers,a.layerList,a.wmc.bbox,a.wmc.crs);$.mobile.hidePageLoadingMsg()})}
function appendLayer(a){clearOwnlist();$.getJSON(searchUrl+"&resourceIds="+a,function(a){a=parseMapBenderJson(a);appendLayerData(a.services,a.layers);$.mobile.hidePageLoadingMsg()})}
function addBaselayers(){$("#baselayers").empty();vector_marker=new OpenLayers.Layer.Vector("Vector Layer",{});gps_marker=new OpenLayers.Layer.Vector("gps_marker",{rendererOptions:{zIndexing:!0}});$("#baselayers").append(BaseLayer("RLP Zusammenstellung",atkis_praes_tms.name));$("#baselayers").append(BaseLayer("Luftbilder",luftbilder.name));$("#baselayers").append(BaseLayer("Keine Hintergrundkarte",grenze_leer.name));map.addLayers([atkis_praes_tms,luftbilder,grenze_leer,vector_marker,gps_marker]);
for(i in baseinfo){var a=baseinfo[i][0],b=baseinfo[i][1];$("#baselayers").append(BaseLayer(a,b));addOpenBaselayer(a,b)}base_check($("#baselayers").find(".baselayer").first())}
var initmap=function(){var a={theme:null,projection:mapProj,units:projUnits,maxExtent:mymapbounds,maxScale:mymaxscale,minScale:myminscale,numZoomLevels:myzoomlevels,scales:myscales,controls:[new OpenLayers.Control.Attribution,new OpenLayers.Control.Navigation({zoomWheelEnabled:!0}),new OpenLayers.Control.KeyboardDefaults,new OpenLayers.Control.TouchNavigation({dragPanOptions:{interval:10,enableKinetic:!0}}),new OpenLayers.Control.ScaleLine({div:document.getElementById("scaleline"),geodesic:!1,maxWidth:100,
topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null}),new OpenLayers.Control.LoadingPanel({})]};map=new OpenLayers.Map("map",a);addmyLayer();"off"!==myzoombounds?map.zoomToExtent(myzoombounds):map.zoomToExtent(map.maxExtent);a=new OpenLayers.Style;a.addRules([new OpenLayers.Rule({symbolizer:sketchSymbolizers})]);a=new OpenLayers.StyleMap({"default":a});measureControls={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,handlerOptions:{layerOptions:{styleMap:a}}}),
polygon:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,handlerOptions:{layerOptions:{styleMap:a}}})};for(var b in measureControls)a=measureControls[b],a.events.on({measure:handleMeasurements,measurepartial:handleMeasurements}),map.addControl(a)};
$(document).ready(function(){window.location.hash&&"#mappage"!=window.location.hash&&$.mobile.changePage($("#mappage"),pageTransition);initmap();zoomSelect&&($("#zoomscale").css("visibility","visible"),createZoomselect(),map.events.register("moveend",null,displayZoom));clickCtrl=new OpenLayers.Control.Click;map.addControl(clickCtrl);clickCtrl.activate();checkLayers();$("#autolayerchange").change(function(){directLayerChange=this.value});$("#layerbut").click(function(){$.mobile.changePage($("#layerpage"),
pageTransition)});$("#searchbut").click(function(){$.mobile.changePage($("#searchpage"),pageTransition)});$("#helpbut").click(function(){$.mobile.changePage($("#helppage"),pageTransition)});$("#gearbut").click(function(){$.mobile.changePage($("#gearpage"),pageTransition)});$("#measurelinebut").click(function(){toggleMeasure("line")});$("#measurepolybut").click(function(){toggleMeasure("polygon")});$("#ovbut").click(function(){map.zoomToExtent(map.maxExtent)});$("#zoominbut").click(function(){map.zoomIn()});
$("#zoomoutbut").click(function(){map.zoomOut()});$("#xheader").click(function(){$("#markerhint").css("visibility","hidden");vector_marker.removeAllFeatures()});$("#mheader").click(function(){$("#measurehint").css("visibility","hidden");toggleMeasure("off")});$("#searchformbut").click(function(){searchCall()});$(document).on("keydown","#searchfield",function(a){13===a.keyCode&&searchCall()});$(".mapbackbut").click(function(){$.mobile.changePage($("#mappage"),pageTransition);$("body").css("overflow",
"hidden")});$("#popupMenu").popup();$("#menubut").click(function(){$("#popupMenu").popup("open")});$("#popupMenu_gps").popup();$("#locatebut").click(function(){$("#popupMenu_gps").popup("open")});$("#gpsstatus").change(function(){"on"===this.value?startgpsWatch():stopgpsWatch()});$(".baselayer_check").click(function(){$(".baselayer_check").css("background-image","url(img/ico_basecheck.png)");$(this).css("background-image","url(img/ico_basecheck_active.png)");for(var a=0;a<map.layers.length;a++)$(this).attr("id")===
map.layers[a].name&&map.setBaseLayer(map.layers[a]);clearanimation();checktranspage()});$(".layer_check").click(function(){for(var a=0;a<map.layers.length;a++)if($(this).attr("id")===map.layers[a].name)var b=a;map.layers[b].getVisibility()?(map.layers[b].setVisibility(!1),$(this).css("background-image","url(img/ico_check.png)")):(map.layers[b].setVisibility(!0),$(this).css("background-image","url(img/ico_check_active.png)"));clearanimation();checktranspage()});$(".poi_check").click(function(){var a=
poilayer.params.LAYERS,b=[];""!=a&&(b=a.split(","));if(-1!=jQuery.inArray($(this).attr("id"),b)){for(a=0;a<b.length;a++)$(this).attr("id")===b[a]&&b.splice(a,1);$(this).css("background-image","url(img/ico_check.png)")}else b.push($(this).attr("id")),$(this).css("background-image","url(img/ico_check_active.png)");a=b.join(",");poilayer.mergeNewParams({layers:a});0<b.length&&poilayer.setVisibility(!0);poilayer.redraw();clearanimation();checktranspage()});$(".query_check").click(function(){$(".query_check").css("background-image",
"url(img/ico_checkop.png)");$(this).css("background-image","url(img/ico_checkop_active.png)");var a=$(this).attr("id"),a=a.substring(0,a.length-6);$("#queryselect").val(a);clearanimation()});$(".query_check").touchstart(function(){$(this).css("background-color","#808080")});$(".layer_check").touchstart(function(){$(this).css("background-color","#808080");$(this).css("color","#FFFFFF")});$(".baselayer_check").touchstart(function(){$(this).css("background-color","#808080");$(this).css("color","#FFFFFF")});
$(".navbuttons").touchstart(function(){$(this).css("border","2px solid #808080")});$(".navbuttons").touchend(function(){$(this).css("border","2px solid "+toolColor)});$(document).on("touchstart",".searchbutton",function(){$(this).css("border","2px solid #808080")});changeHand(defaultHand);$("#autolayerchange").val(directLayerChange);hideAddressBar()});
var clearanimation=function(){$(".query_check").css("background-color","#808080");$(".layer_check, .baselayer_check, .poi_check").css("background-color","#FFFFFF");$(".layer_check, .baselayer_check, .poi_check").css("color","#000000")},checktranspage=function(){"on"===directLayerChange&&$.mobile.changePage($("#mappage"),pageTransition)},checkLayers=function(){$(".baselayer_check").each(function(){for(var a=0;a<map.layers.length;a++)map.layers[a].name===$(this).attr("id")&&map.layers[a].visibility&&
$(this).css("background-image","url(img/ico_basecheck_active.png)")});$(".layer_check").each(function(){for(var a=0;a<map.layers.length;a++)map.layers[a].name===$(this).attr("id")&&map.layers[a].visibility&&$(this).css("background-image","url(img/ico_check_active.png)")});$(".poi_check").each(function(){var a=poilayer.params.LAYERS,b=[];""!=a&&(b=a.split(","));-1!=jQuery.inArray($(this).attr("id"),b)&&$(this).css("background-image","url(img/ico_check.png)")});$(".query_check").each(function(){var a=
$(this).attr("id");a.substring(0,a.length-6)===$("#queryselect").val()&&$(this).css("background-image","url(img/ico_checkop_active.png)")})};function searchCall(){"google"===searchMode?codeAddress():"streetsearch"===searchMode?searchStreet($("#searchfield").val()):"mapbendersearch"===searchMode?searchMapbender($("#searchfield").val()):alert("kein Suchmodus konfiguriert!")}function setMarkerhint(a,b){$("#xheader").html(a);$("#xcontent").html(b);$("#markerhint").css("visibility","visible")}
function hideAddressBar(){window.location.hash||(document.height<=window.outerHeight+10?(document.body.style.height=window.outerHeight+50+"px",setTimeout(function(){window.scrollTo(0,1)},50)):setTimeout(function(){window.scrollTo(0,1)},0))}
function changeHand(a){"l"===a?(defaultHand="l",$("#scaleline, #copyright, #zoomscale").css("left","auto").css("right","4px"),$("#navbutgroup").css("right","auto").css("left","4px")):(defaultHand="r",$("#scaleline, #copyright, #zoomscale").css("right","auto").css("left","4px"),$("#navbutgroup").css("left","auto").css("right","4px"))}function changeFeatureInfo(){}
function changeLanguage(a,b){window.lang.change(a);$.mobile.showPageLoadingMsg();$.ajax({url:"help/help_"+a+".html",cache:!0}).done(function(a){$("#helpdiv").html(a);$.mobile.hidePageLoadingMsg()});b&&$("#select-hand").selectmenu("refresh",!0);$("#select-lang").val(a)}
function codeAddress(){adressgeocoder=new google.maps.Geocoder;var a=document.getElementById("searchfield").value;adressgeocoder.geocode({address:a},function(b,c){if(c===google.maps.GeocoderStatus.OK){var d="no";for(i=0;i<b[0].address_components.length;i++)b[0].address_components[i].long_name===googleGeocodeAdmin&&(d="ok");if("ok"!=d)alert("Adresse liegt nicht in "+googleGeocodeAdmin+"!");else{var d=b[0].formatted_address,e=b[0].geometry.location.lat(),f=b[0].geometry.location.lng(),g=new google.maps.LatLng(e,
f),h={zoom:11,center:g,mapTypeId:google.maps.MapTypeId.ROADMAP},h=new google.maps.Map(document.getElementById("mygooglemap"),h);new google.maps.Marker({map:h,position:g});d=window.lang.convert("Suchergebnis: ")+d+'  <br><div class="searchbutton" onClick="zoomtosearchpoint(\''+d+"',"+f+","+e+')" >'+window.lang.convert("Zoom auf Ergebnis in Karte")+"</div>";$("#mygooglelink").html(d)}}else alert("Geocode nicht erfolgreich, Fehler: "+a+"  "+c)})}
function searchStreet(a){$.mobile.showPageLoadingMsg();$("#search_results").empty();$.getJSON("mod_streetsearch/street_full.php?lang=de&searchfield="+a,function(a){if("++"===a.totalResultsCount){var c='<li data-role="list-divider">'+window.lang.convert("Zu viele Datens\u00e4tze! Bitte schr\u00e4nken Sie Ihre Suche ein!")+"</li>";$("#search_results").append(c);$("#search_results").listview("refresh")}else c='<li data-role="list-divider"> '+a.totalResultsCount+" "+window.lang.convert("Suchergebnisse")+
"</li>",$("#search_results").append(c),$.each(a.geonames,function(a,b){c="";c+='<li><a href="javascript:void(0);" onClick="searchHsn(\''+b.strid+"');\" ><h2>"+b.title1+"</h2>";c+="<p>"+b.title2+"</p></a></li>";$("#search_results").append(c)}),$("#search_results").listview("refresh"),a={words:$('input[name="searchfield"]').val()},highlight("search_results",a);$.mobile.hidePageLoadingMsg()})}
function searchHsn(a){$.mobile.showPageLoadingMsg();$("#search_results").empty();$.getJSON("mod_streetsearch/street_hsn.php?lang=de&strid="+a,function(a){var c='<li data-role="list-divider" ><a href="javascript:void(0);" onClick="zoomtosearchpoint(\''+a.street+"',"+a.streetx+","+a.streety+');" ><h2>'+a.street+"</h2>",c=c+("<p>"+a.totalResultsCount+" "+window.lang.convert("Hausnummern")+"</p></a></li>");$("#search_results").append(c);$.each(a.geonames,function(d,e){c="";c+='<li><a href="javascript:void(0);" onClick="zoomtosearchpoint(\''+
a.street+" "+e.title1+"',"+e.x+","+e.y+');" ><h2>Nr. '+e.title1+"</h2>";c+="<p>"+e.title2+"</p></a></li>";$("#search_results").append(c)});$("#search_results").listview("refresh");$.mobile.hidePageLoadingMsg()})}
function searchMapbender(a){$.mobile.showPageLoadingMsg();$("#search_results").empty();$.getJSON(mapbendersearchurl+searchEPSG+("&searchText="+a),function(a){if(500<a.totalResultsCount){var c='<li data-role="list-divider" >'+window.lang.convert("Zu viele Datens\u00e4tze! Bitte schr\u00e4nken Sie Ihre Suche ein!")+"</li>";$("#search_results").append(c);$("#search_results").listview("refresh")}else c='<li data-role="list-divider" > '+a.totalResultsCount+" "+window.lang.convert("Suchergebnisse")+"</li>",
$("#search_results").append(c),$.each(a.geonames,function(a,b){var f=(parseInt(b.minx)+parseInt(b.maxx))/2,g=(parseInt(b.miny)+parseInt(b.maxy))/2;c="";c="gemeinde_neu"===b.category||"Gemeinde"===b.category||"verbandsgemeinde"===b.category||"kreis"===b.category||"Kreis"===b.category?c+('<li><a href="javascript:void(0);" onClick="zoomtoextent(\''+b.title+"',"+b.minx+","+b.miny+","+b.maxx+","+b.maxy+');" ><h2>'+b.title+"</h2>"):c+('<li><a href="javascript:void(0);" onClick="zoomtosearchpoint(\''+b.title+
"',"+f+","+g+');" ><h2>'+b.title+"</h2>");c+="<p>"+b.category+"</p></a></li>";$("#search_results").append(c)}),$("#search_results").listview("refresh"),a={words:$('input[name="searchfield"]').val()},highlight("search_results",a);$.mobile.hidePageLoadingMsg()})}
function highlight(a,b){var c={words:"",caseSensitive:!1,wordsOnly:!0,template:'$1<span class="highlight">$2</span>$3'},d;$.extend(!0,c,b||{});0!=c.words.length&&(d=RegExp("(>[^<.]*)("+c.words+")([^<.]*)",c.caseSensitive?"":"ig"),$("#"+a).each(function(){var a=$(this).html();a&&$(this).html(a.replace(d,c.template))}))}
function zoompoint(a,b){var c=new OpenLayers.LonLat(a,b),d=new OpenLayers.Geometry.Point(a,b),e=new OpenLayers.Geometry.Point(a,b);vector_marker.removeAllFeatures();vector_marker.addFeatures([new OpenLayers.Feature.Vector(d,{},olSearchSymbol),new OpenLayers.Feature.Vector(e,{},olFeaturequerySymbol)]);map.setCenter(c,getZoomlevel())}
function zoomtosearchpoint(a,b,c){setMarkerhint(window.lang.convert("Suchergebnis: "),a);a=new OpenLayers.LonLat(b,c);if("google"===searchMode)var d=a.transform(wgs84Proj,mapProj);else if("streetsearch"===searchMode||"mapbendersearch"===searchMode)d=a;a=new OpenLayers.Geometry.Point(d.lon,d.lat);b=new OpenLayers.Geometry.Point(d.lon,d.lat);vector_marker.removeAllFeatures();vector_marker.addFeatures([new OpenLayers.Feature.Vector(a,{},olSearchSymbol),new OpenLayers.Feature.Vector(b,{},olFeaturequerySymbol)]);
map.setCenter(d,getZoomlevel());$.mobile.changePage($("#mappage"),pageTransition)}function zoomtoextent(a,b,c,d,e){b=new OpenLayers.Bounds(b,c,d,e);""!==a&&setMarkerhint(window.lang.convert("Suchergebnis: "),a);map.zoomToExtent(b);$.mobile.changePage($("#mappage"),pageTransition)}function getZoomlevel(){var a=Math.round(map.zoom.toFixed(4));return a>searchZoom?a:searchZoom}
function createZoomselect(){$.each(myscales,function(a,b){$("#selectzoom").append($("<option/>",{value:a,text:"1:"+b}))});$("#selectzoom").selectmenu();displayZoom()}function displayZoom(){var a=Math.round(map.zoom.toFixed(4));$("#selectzoom").val(""+a+"");$("#selectzoom").selectmenu("refresh",!0)}function changeScale(a){map.zoomTo(a);checktranspage();hideAddressBar()}
function handleMeasurements(a){var b=a.units,c=a.order,a=a.measure,d=document.getElementById("measureoutput"),e="",e=1==c?e+(window.lang.convert("Entfernung: ")+"<strong>"+a.toFixed(2)+"</strong> "+b):e+(window.lang.convert("Fl\u00e4che: ")+"<strong>"+a.toFixed(2)+"</strong> "+b+"<sup>2</sup>");d.innerHTML=e}
function toggleMeasure(a){clickCtrl.deactivate();$("#popupMenu").popup("close");measureControls.line.deactivate();measureControls.polygon.deactivate();"line"===a?($("#measurehint").css("visibility","visible"),measureControls[a].activate(),$("#measureoutput").html(window.lang.convert("Entfernungsmessung aktiv!"))):"polygon"===a?($("#measurehint").css("visibility","visible"),measureControls[a].activate(),$("#measureoutput").html(window.lang.convert("Fl\u00e4chenmessung aktiv!"))):clickCtrl.activate()}
function setmapsize(){window.scrollTo(0,0);var a=$.mobile.getScreenHeight(),b=$('[data-role="header"]').first().outerHeight(),c=$('[data-role="footer"]').first().outerHeight(),d=$('[data-role="content"]'),e=parseInt(d.css("padding-left").replace("px",""))+parseInt($('[data-role="content"]').css("padding-right").replace("px","")),f=parseInt(d.css("padding-top").replace("px",""))+parseInt($('[data-role="content"]').css("padding-bottom").replace("px","")),a=a-b-c-f;winwide=$(document).width();winwide-=
e;d.css("width",winwide+"px").css("height",a+"px");$("#map").css("width",winwide+"px").css("height",a+"px")}function checkZindex(){for(var a=map.layers,b=0,c=a.length;b<c;b++)"tk_grau"===a[b].name&&alert("name:"+a[b].name+" zindex:"+a[b].div.style.zIndex),"Vector Layer"===a[b].name&&alert("name:"+a[b].name+" zindex:"+a[b].div.style.zIndex)}
var startgpsWatch=function(){navigator.geolocation&&($("#gpsmessage").html('<div id="gpsmessagebox">start watching...</div>'),gpswatch=navigator.geolocation.watchPosition(gpsokCallback,gpsfailCallback,gpsOptions))},stopgpsWatch=function(){navigator.geolocation.clearWatch(gpswatch);$("#gpsmessage").html("");$("#gpsinfo").css("visibility","hidden");gps_marker.removeAllFeatures();$("#activePosition").val("")},gpsokCallback=function(a){var b="Lat: "+a.coords.latitude+"<br>Lon: "+a.coords.longitude+"<br>Genauigkeit: ~"+
Math.round(a.coords.accuracy)+" m";$("#gpsmessage").html('<br><a href="#" id="zoomGpspoint" data-role="button" data-icon="arrow-r" data-iconpos="right" data-inline="true"  data-mini="true" >Zoom auf Position</a><br><br>');$("#gpsinfo").html("<strong>Positionierung aktiv</strong><br>"+b);$("#gpsinfo").css("visibility","visible");var c=(new OpenLayers.LonLat(a.coords.longitude,a.coords.latitude)).transform(wgs84Proj,mapProj);$("#zoomGpspoint").bind("click",function(){map.setCenter(c,getZoomlevel())});
$("#zoomGpspoint").button();$("#searchGpspoint").bind("click",function(){$.mobile.changePage($("#searchpage2"),pageTransition);$("#searchSort").val("sortdist1");$("#searchSort").selectmenu("refresh");$("#search_results_poi").empty();$("#searchfield_poi").empty()});$("#searchGpspoint").button();$("#activePosition").val(Math.round(c.lon)+","+Math.round(c.lat));c.lon>map.maxExtent.left&&c.lon<map.maxExtent.right&&c.lat>map.maxExtent.bottom&&c.lat<map.maxExtent.top?(b=new OpenLayers.Geometry.Point(c.lon,
c.lat),new OpenLayers.Geometry.Point(c.lon,c.lat),gps_marker.removeAllFeatures(),gps_marker.addFeatures([new OpenLayers.Feature.Vector(b,{},olGpsSymbol),new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(c.lon,c.lat),a.coords.accuracy/2,50,0),{},olGpscircleStyle)]),"on"===$("#gpscenter").val()&&map.setCenter(c)):(alert(window.lang.convert("Die ermittelte Position liegt au\u00dferhalb des darstellbaren Kartenausschnitts!")),$("#gpsstatus").val("off"),
$("#gpsstatus").slider("refresh"),stopgpsWatch())},gpsfailCallback=function(){},gpsOptions={enableHighAccuracy:!0,timeout:5E3,maximumAge:0};
